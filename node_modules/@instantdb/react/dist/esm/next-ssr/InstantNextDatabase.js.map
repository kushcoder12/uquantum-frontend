{"version":3,"file":"InstantNextDatabase.js","sourceRoot":"","sources":["../../../src/next-ssr/InstantNextDatabase.tsx"],"names":[],"mappings":"AAQA,OAAO,uBAAuB,MAAM,+BAA+B,CAAC;AACpE,OAAO,EAAE,UAAU,EAAE,MAAM,OAAO,CAAC;AACnC,OAAO,EAAE,qBAAqB,EAAE,MAAM,8BAA+B,CAAC;AAEtE,MAAM,OAAO,mBAGX,SAAQ,uBAAyC;IAHnD;;QAIS,qBAAgB,GAAG,CACxB,CAAI,EACJ,IAEC,EAID,EAAE;YACF,MAAM,GAAG,GAAG,UAAU,CAAC,qBAAqB,CAAC,CAAC;YAC9C,IAAI,CAAC,GAAG,EAAE,CAAC;gBACT,MAAM,IAAI,KAAK,CACb,8DAA8D,CAC/D,CAAC;YACJ,CAAC;YACD,OAAO,GAAG,CAAC,gBAAgB,CAAC,CAAC,EAAE,IAAI,CAAQ,CAAC;QAC9C,CAAC,CAAC;QAEF,YAAO,GAAG,GAAc,EAAE;YACxB,MAAM,GAAG,GAAG,UAAU,CAAC,qBAAqB,CAAC,CAAC;YAC9C,MAAM,cAAc,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;YACvC,IAAI,CAAC,GAAG,EAAE,CAAC;gBACT,OAAO,cAAc,CAAC;YACxB,CAAC;YAED,MAAM,EAAE,OAAO,EAAE,GAAG,GAAG,CAAC;YACxB,IAAI,OAAO,KAAK,SAAS,EAAE,CAAC;gBAC1B,OAAO,cAAc,CAAC;YACxB,CAAC;YACD,IAAI,cAAc,CAAC,SAAS,EAAE,CAAC;gBAC7B,OAAO;oBACL,KAAK,EAAE,SAAS;oBAChB,SAAS,EAAE,KAAK;oBAChB,IAAI,EAAE,OAAO,aAAP,OAAO,cAAP,OAAO,GAAI,SAAS,EAAE,qCAAqC;iBAClE,CAAC;YACJ,CAAC;YAED,OAAO,cAAc,CAAC;QACxB,CAAC,CAAC;IACJ,CAAC;CAAA","sourcesContent":["import {\n  AuthState,\n  InstantSchemaDef,\n  InstaQLResponse,\n  PageInfoResponse,\n  RuleParams,\n  ValidQuery,\n} from '@instantdb/core';\nimport InstantReactWebDatabase from '../InstantReactWebDatabase.ts';\nimport { useContext } from 'react';\nimport { SuspsenseQueryContext } from './InstantSuspenseProvider.tsx';\n\nexport class InstantNextDatabase<\n  Schema extends InstantSchemaDef<any, any, any>,\n  UseDates extends boolean,\n> extends InstantReactWebDatabase<Schema, UseDates> {\n  public useSuspenseQuery = <Q extends ValidQuery<Q, Schema>>(\n    q: Q,\n    opts?: {\n      ruleParams: RuleParams;\n    },\n  ): {\n    data: InstaQLResponse<Schema, Q, NonNullable<UseDates>>;\n    pageInfo?: PageInfoResponse<Q>;\n  } => {\n    const ctx = useContext(SuspsenseQueryContext);\n    if (!ctx) {\n      throw new Error(\n        'useSuspenseQuery must be used within a SuspenseQueryProvider',\n      );\n    }\n    return ctx.useSuspenseQuery(q, opts) as any;\n  };\n\n  useAuth = (): AuthState => {\n    const ctx = useContext(SuspsenseQueryContext);\n    const realAuthResult = this._useAuth();\n    if (!ctx) {\n      return realAuthResult;\n    }\n\n    const { ssrUser } = ctx;\n    if (ssrUser === undefined) {\n      return realAuthResult;\n    }\n    if (realAuthResult.isLoading) {\n      return {\n        error: undefined,\n        isLoading: false,\n        user: ssrUser ?? undefined, // null -> undefined for the response\n      };\n    }\n\n    return realAuthResult;\n  };\n}\n"]}